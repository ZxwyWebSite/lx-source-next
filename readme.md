## LX-Source _Next_

### 简介

🎵 新一代在线音乐解析工具，听歌自由从这里开始

时隔一年，又和大家见面啦！😊😊😊

高三以后基本就没时间继续维护了，能续多久用多久吧。

—— Zxwy 2025/08/31 : )

### 注意

**项目定位:** 个人自用与小范围分享使用。

本项目不建议用于大规模运营也没能力支撑庞大的用户数量，官方接口的风控会第一个不答应。

**低调使用，切勿大肆宣传！！！传的越多，凉的越快**

**低调使用，切勿大肆宣传！！！传的越多，凉的越快**

**低调使用，切勿大肆宣传！！！传的越多，凉的越快**

---

### 演示站

**仅供演示，不提供付费内容解析**

**`Serv00`:** [演示歌曲](http://31.186.83.254:16646/outer/#/url/wy/1999253939) / [音乐搜索](http://31.186.83.254:16646/search/) / [数据统计](http://31.186.83.254:16646/status.html)

**`Render`:** [演示歌曲](https://lxsrcs.onrender.com/outer/#/url/wy/2143960009) / [音乐搜索](https://lxsrcs.onrender.com/search/) / [数据统计](https://lxsrcs.onrender.com/status.html) / [听歌识曲](https://lxsrcs.onrender.com/match/)

首次加载可能较慢，请耐心等待，缓存之后速度会大幅提升

---

### 更新内容

**本工具并不面向新手，发布前已进行充分 ~~（一天）~~ 的测试，请先充分阅读文档，解决不了再发帖求助。**

ztool/fbjs: 彻底修复普通用户初始化创建文件时报错权限不足的问题

**本地缓存：**

虽然还未能完成接口化，但还是把规则筛选做出来了，现在可以根据平台与音质配置是否缓存内容。

**支持来源：**

WY：更新模拟客户端参数。但由于官方加强检测，旧版客户端无法正常登录，如需使用自己会员账号请在网页端登录后导入 Cookie

MG：由于上游接口更新，原 `malbum` 方式失效，内置接口也只能获取非会员歌曲。

<!-- 现在重新实现了一种方式，不知道能用多久 -->

KW：还是原版 DES 接口，经历了两波大规模修复，不知道还能活多久。

KG：暂未完善。请使用 [MakcRe/KuGouMusicApi](https://github.com/MakcRe/KuGouMusicApi) 项目登录或手动抓包。

TX：南山必胜客绿尸寒警告，接口限制严格，无法免费听歌，现已移除内置实现。

**错误提示：**

原版默认错误音频使用 CDN 链接，由于域名过期，错误音频现由程序直接提供，添加过期时间戳支持，使客户端自动刷新，以免污染缓存。

### 接口定义：

格式基本兼容旧版接口，但需要添加 `/api/v0` 前缀。

可直接使用旧版脚本接入

格式：`/api/v0/{method}/{source}/{songid}/{quality}`

**method**：方法

`url` / `link`：获取播放链接

`lrc` / `lyric`：获取歌词

`mov` / `mv`：获取视频链接

`mid`：获取音乐信息

`vid`：获取视频信息

`pic`：获取专辑封面

**source**：来源

`wy` / `mg` / `kw` / `kg`

**songid**：音乐 ID

_不用多说了吧_

**quality**：质量

`url`：`128k` / `192k` / `320k` / `flac` / `flac24bit/fl24` / `dolby`(VIP) / `sky`(SVIP) / `master`

`mv`：`240p` / `360p` / `480p` / `720p` / `1080p`

`pic`：`s(mall)`[256] / `m(iddle)`[512] / `l(arge)`[1024] / `""` 原图 / `2048` 自定义（部分支持）

查询参数：

**jmp**：链接跳转

302 重定向到解析结果链接，若发生错误以 json 形式返回。

支持 `url` / `mv` / `pic` 方式

+`lrc`: 返回 正文+翻译?+罗马? (`v1.1.9+`)

**key**：接口密钥

适用于无法设置请求头的情况。

---

**脚本下载**：`/api/v0/lx-script.js`

查询参数：

**raw**：下载模式

浏览器默认会以预览模式打开，此参数设置标头让浏览器下载文件。

**key**：接口密钥

开启接口密钥功能后，用于注入用户密钥。

~~（时间问题，没有任何更新，直接把旧版 lx-script 搬上去的）~~

---

新版接口（未完成）

**歌曲搜索**：`/api/v1/search/{pt}/{t}/{q}/{pg}/{sz}`

也支持在 `/api/v1/search` 以查询字符串方式传入

或者 `/api/v1/search/{pt}/{t}/{q}?pg=1&sz=10`

`pt`：平台二字码，仅支持 `wy`

`t`：`type` 查询类型，目前支持 `so`：单曲 `ly`：歌词

`q`：查询内容

`pg`：`page` 分页号，从 1 开始

`sz`：`size` 返回数量

---

**流式日志**：`/api/v1/test/sse`

需要在配置文件中开启 `[Apis].WebLog`

参考 `/test/sse/index.html` 实现

**缓存文件**：`/api/v1/file/{path}`

路径格式：`{source}/{musicid}/{quality}.{ext}`

**听歌识曲**：`/api/v1/test/match`

参考 `/match/match.html` 实现

---

### 使用方式：

默认监听地址 `127.0.0.1:1011,1101`，前者为保持兼容，在 类 Unix 设备上非特权用户一般无法监听，建议使用 `:1101` 端口。

启动程序后在 `data/conf.toml` 的 `[Auth.ApiPass].Value` 找到自动生成的接口密钥，复制备用。

洛雪导入脚本 `http://127.0.0.1:1101/api/v0/lx-script.js?key={key}`

或 `http://127.0.0.1:1101/api/v0/script` (`v1.1.7+`)

或使用网页版（仅供测试）

- 统计信息 `/status.html`
- 解析系统 `/outer`
- 音乐搜索 `/search`
- 听歌识曲 `/match`
- 播放列表 `/pls`

其中听歌识曲需要在 HTTPS 或本地环境（127.0.0.1）使用，否则无法开启麦克风权限。

或在 `chrome://flags/#unsafely-treat-insecure-origin-as-secure` 中填写对应地址 `http://192.168.10.22:1101`（仅供测试）

配置热重载功能现处于“能用”的状态，即基本不会出现什么致命错误，但会导致缓存清空，与重启程序没什么差别。

---

新版使用自动 URL 补全功能，如有反向代理请确保以下请求头被正确添加：

```nginx
# 添加过 Host 就不用了
proxy_set_header X-Forwarded-Host $http_host;
# 使用 https 的建议添加
proxy_set_header X-Forwarded-Proto $scheme;
# 外部非标准端口需要
proxy_set_header X-Forwarded-Port $server_port;
# 二级目录支持有限，不建议使用
proxy_set_header X-Forwarded-Prefix '/lxs';
```

<details>
<summary>二级目录示例 (v1.1.10 完整支持)</summary>

```nginx
location ^~ /bg/ {
    proxy_pass http://127.0.0.1:1101/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Prefix '/bg';
}
```

</details>

---

### 命令行工具：

```sh
# bash
./lxsrcs -m

# cmd
lxsrcs.exe -m
```

---

<!-- ### 项目架构：

&emsp;首先声明我也只是新手，目前由于架构不合理导致的问题还有很多没有解决

&emsp;整体沿用了旧版架构，但并未完全照搬，还有部分接口未实现，

&emsp;新版采用接口与来源分离的设计方式，即 `MusicSDK` 仅提供与官方平台对接的能力，由 `sources` 转换为通用结构体，便于统一响应。

--- -->

### 暂不开源：

借用某同类项目运营者的话：「搞音乐平台的开源就是在加速作死。」

<!-- 圣地巡礼：https://github.com/qyhqiu/kuwoMusicApi/issues/24#issuecomment-3187428782 -->

一方面会增大接口滥用的风险，倒卖狗借以获利

一旦被官方发现必定会遭到针对性修复，那样谁都别想用了

有时候「只是大家都不想放出来被和谐罢了」

如果你是同类项目作者，有意向参与开发，可以申请加入私库查看代码。

只有这样才可能让它活的更久一点。

---

### 项目协议

本项目基于 [MIT] 许可证发行，以下协议是对于 MIT 原协议的补充，如有冲突，以以下协议为准。

词语约定：本协议中的“本项目”指本开源项目；“使用者”指签署本协议的使用者；“官方音乐平台”指对本项目内置的包括酷我、酷狗、咪咕等音乐源的官方平台统称；“版权数据”指包括但不限于图像、音频、名字等在内的他人拥有所属版权的数据。

1. 本项目的数据来源原理是从各官方音乐平台的公开服务器中拉取数据，经过对数据简单地筛选与合并后进行展示，因此本项目不对数据的准确性负责。
2. 使用本项目的过程中可能会产生版权数据，对于这些版权数据，本项目不拥有它们的所有权，为了避免造成侵权，使用者务必在**24 小时**内清除使用本项目的过程中所产生的版权数据。
3. 由于使用本项目产生的包括由于本协议或由于使用或无法使用本项目而引起的任何性质的任何直接、间接、特殊、偶然或结果性损害（包括但不限于因商誉损失、停工、计算机故障或故障引起的损害赔偿，或任何及所有其他商业损害或损失）由使用者负责。
4. 本项目完全免费，且开源发布于 GitHub 面向全世界人用作对技术的学习交流，本项目不对项目内的技术可能存在违反当地法律法规的行为作保证，**禁止在违反当地法律法规的情况下使用本项目**，对于使用者在明知或不知当地法律法规不允许的情况下使用本项目所造成的任何违法违规行为由使用者承担，本项目不承担由此造成的任何直接、间接、特殊、偶然或结果性责任。

若你使用了本项目，将代表你接受以上协议。

音乐平台不易，请尊重版权，支持正版。  
本项目仅用于对技术可行性的探索及研究，不接受任何商业（包括但不限于广告等）合作及捐赠。  
若对此有疑问请 mail to: admin+zxwy.tk (请将`+`替换为`@`)

<!--
# ※ 此字段用于防止部分国内平台无脑转载，并不代表同意其中观点。
// magic file to keep your code away from gitcode/csdn/some fucking Chinese shit

+1s 蛤蛤 苟利国家生死以 岂因祸福避趋之
习近平 丁真 药娘 mtf 大奶子 淫水 乳液狂飙
天安门 69 8964 坦克 原神
反动 起义 这就是中国 中国人
文化大革命 台湾 香港 独立 自信 邪教
法轮功 屠杀
华为 爱国 996 猝死
孙笑川 核废水泄露 爱国
就业率 底下
-->
